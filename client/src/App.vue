<template>
  <div id="app">
    <!-- 资金区 -->
    <SectionHeaderComponent title="大陆及沪港通资金流向" v-on:shouldShow="shouldShowMoney"/>
    <transition name='fade'>
      <div v-if="showMoney">
        <MoneyComponent :moneyinfo="moneyinfo"/>
        <!-- 板块资金区 -->
        <IndustryMoneyChartComponent :industryMoneyInfo="industryMoneyInfo"/>
      </div>
    </transition>
    <!-- 涨跌平区 -->
    <SectionHeaderComponent title="指数涨跌分布" v-on:shouldShow="shouldShowZDP"/>
    <transition name='fade'>
      <div v-if="showZDP">
        <!-- 涨跌平区 -->
        <RiseFallBarComponent :zdpinfo="zdpinfo"/>
        <!-- 涨跌停区 -->
        <RiseFallMaxBarComponent :zdt="zdt"/>
        <!-- 涨跌分布区 -->
        <RiseFallChartComponent :values="zdfb"/>
      </div>
    </transition>
    <!-- 指数区 -->
    <SectionHeaderComponent title="中国大陆及港台地区" v-on:shouldShow="shouldShowChina"/>
    <transition name='fade'>
      <div v-if="showChina">
        <IndexComponent :indexInfos="china" :showType="0"/>
      </div>
    </transition>
    <SectionHeaderComponent title="亚洲地区" v-on:shouldShow="shouldShowAsian"/>
    <transition name='fade'>
      <div v-if="showAsian">
        <IndexComponent :indexInfos="asian" :showType="0"/>
      </div>
    </transition>
    <SectionHeaderComponent title="欧洲地区" v-on:shouldShow="shouldShowEuro"/>
    <transition name='fade'>
      <div v-if="showEuro">
        <IndexComponent :indexInfos="euro" :showType="0"/>
      </div>
    </transition>
    <SectionHeaderComponent title="美洲地区" v-on:shouldShow="shouldShowAmerica"/>
      <transition name='fade'>
        <div v-if="showAmerica">
          <IndexComponent :indexInfos="america" :showType="0"/>
        </div>
      </transition>
    <SectionHeaderComponent title="股指及商品期货" v-on:shouldShow="shouldShowGoods"/>
    <transition name='fade'>
      <div v-if="showGoods">
        <IndexComponent :indexInfos="goods" :showType="0"/>
      </div>
    </transition>
    <SectionHeaderComponent title="外汇牌价" v-on:shouldShow="shouldShowExchanges"/>
      <transition name='fade'>
      <div v-if="showExchanges">
        <IndexComponent :indexInfos="exchanges" :showType="0"/>
      </div>
    </transition>
    
    <SectionHeaderComponent title="固定收益债券" v-on:shouldShow="shouldShowBond"/>
    <transition name='fade'>
      <div v-if="showBond">
        <IndexComponent :indexInfos="bond" :showType="0"/>
      </div>
    </transition>
    
  </div>
</template>

<script>

import axios from 'axios'
import Vue from 'vue'

// 标题板块
import SectionHeaderComponent from './components/SectionHeaderComponent'
// 资金组件
import MoneyComponent from './components/MoneyComponent'
// 板块资金组件
import IndustryMoneyChartComponent from './components/IndustryMoneyChartComponent'
// 涨跌平组件
import RiseFallBarComponent from './components/RiseFallBarComponent'
// 涨跌停组件
import RiseFallMaxBarComponent from './components/RiseFallMaxBarComponent'
// 涨跌分布组件
import RiseFallChartComponent from './components/RiseFallChartComponent'
// 指数组件
import IndexComponent from './components/IndexComponent'

Vue.prototype.$axios = axios
Vue.config.productionTip = false

export default {
  name: 'App',
  components: {
    SectionHeaderComponent,
    MoneyComponent,
    IndustryMoneyChartComponent,
    RiseFallBarComponent,
    RiseFallMaxBarComponent,
    RiseFallChartComponent,
    IndexComponent
  },
  props: [
    'moneyinfo',
    'zdpinfo',
    'zdt',
    'zdfb',
    'industryMoneyInfo',
    'china',
    'asian',
    'euro',
    'america',
    'goods',
    'exchanges',
    'bond'
  ],
  data () {
    return {
      showMoney: true,
      showZDP: true,
      showChina: true,
      showAsian: true,
      showEuro: true,
      showAmerica: true,
      showGoods: true,
      showExchanges: true,
      showBond: true
    }
  },
  methods: {
    shouldShowMoney() {
      this.showMoney = !this.showMoney
    },
    shouldShowZDP() {
      this.showZDP = !this.showZDP
    },
    shouldShowChina() {
      this.showChina = !this.showChina
    },
    shouldShowAsian() {
      this.showAsian = !this.showAsian
    },
    shouldShowEuro() {
      this.showEuro = !this.showEuro
    },
    shouldShowAmerica() {
      this.showAmerica = !this.showAmerica
    },
    shouldShowGoods() {
      this.showGoods = !this.showGoods
    },
    shouldShowExchanges() {
      this.showExchanges = !this.showExchanges
    },
    shouldShowBond() {
      this.showBond = !this.showBond
    }
  },
  created: function () {
    var that = this
    // 请求资金数据
    this.$axios.get('http://112.125.25.230/api/moneyinfo').then(function (response) {
      that.moneyinfo = response.data.data
      // 行业资金净流入用图标表示
      that.industryMoneyInfo = that.moneyinfo.pop(-1)
      // 两市成交额与融资融券是0，显示灰底。其他是1，显示涨跌底色
      var showTypes = [0, 0, 1, 1, 1]
      for (var index in that.moneyinfo) {
        that.moneyinfo[index].showType = showTypes[index]
      }
    })
    // 请求涨跌数据
    this.$axios.get('http://112.125.25.230/api/zdpinfo').then(function (response) {
      // 指数涨跌平
      that.zdpinfo = response.data.data[2].value
      // 全市场涨跌停
      that.zdt = response.data.data[1].value
      // 全市场涨跌分布
      that.zdfb = response.data.data[0].value
    })
    // 请求中国
    this.$axios.get('http://112.125.25.230/api/indexs/china').then(function (response) {
      that.china = response.data.data
    })
    // 请求亚洲
    this.$axios.get('http://112.125.25.230/api/indexs/asian').then(function (response) {
      that.asian = response.data.data
    })
    // 请求欧洲
    this.$axios.get('http://112.125.25.230/api/indexs/euro').then(function (response) {
      that.euro = response.data.data
    })
    // 请求美洲
    this.$axios.get('http://112.125.25.230/api/indexs/america').then(function (response) {
      that.america = response.data.data
    })
    // 请求期货&外汇
    this.$axios.get('http://112.125.25.230/api/goods_and_exchanges').then(function (response) {
      that.goods = response.data.data.goods
      that.exchanges = response.data.data.exchanges
    })
    // 债券&组合
    this.$axios.get('http://112.125.25.230/api/bondinfo').then(function (response) {
      that.bond = []
      for (var item in response.data.data[0].value) {
        that.bond.push(response.data.data[0].value[item])
      }
      for (item in response.data.data[1].value) {
        that.bond.push(response.data.data[1].value[item])
      }
      for (item in response.data.data[2].value) {
        that.bond.push(response.data.data[2].value[item])
      }
    })
  }
}
</script>

<style lang="less" rel="stylesheet/less">

@import './assets/css/style.less';

#app {
  width: 856px; /* 240 + 4 * 4 + 200 * 3 = 856 */
  background-color: @app-bg-color;
}
</style>
